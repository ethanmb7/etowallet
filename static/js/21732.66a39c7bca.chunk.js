"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[21732],{82506:(e,n,t)=>{t.d(n,{d:()=>useDebounce});var r=t(578104);function useDebounce(e,n,t){var[o]=(0,r.d7)(e,n,t);return o}},278484:(e,n,t)=>{t.d(n,{wI:()=>DAppAccountListItem,ZY:()=>DAppAccountListStandAloneItem,X1:()=>DAppAccountListStandAloneItemForHomeScene,VV:()=>WalletConnectAccountTriggerList});var r=t(460986),o=t.n(r),c=t(324586),s=t(586330),i=t(514041),a=t(908867),u=t(17617),d=t(490343),l=t(610421),p=t(325809),g=t(237532),A=t(24284),m=t(911998),f=t(162616),h=t(226952),S=t(334439),b=(t(663522),t(584186)),x=t(714191),I=t(82506);var y=t(831085);function ownKeys(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function _objectSpread(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ownKeys(Object(t),!0).forEach((function(n){(0,c.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function DAppAccountListInitFromHome({num:e,shouldSyncFromHome:n}){var[,t]=(0,f.K7)(),r=(0,f.z$)();return(0,i.useEffect)((function(){return(0,s.A)((function*(){try{t((function(n){return _objectSpread(_objectSpread({},n),{},{[e]:{isLoading:!0}})})),yield b.A.wait(600),n&&(yield r.current.syncFromScene({from:{sceneName:x.Zs.home,sceneNum:0},num:e}))}finally{n&&(yield b.A.wait(300)),t((function(n){return _objectSpread(_objectSpread({},n),{},{[e]:{isLoading:!1}})}))}}))(),function(){t((function(n){return _objectSpread(_objectSpread({},n),{},{[e]:{isLoading:!1}})}))}}),[r,e,t,n]),null}function DAppAccountListItem({num:e,handleAccountChanged:n,readonly:t,networkReadonly:r,compressionUiMode:o,initFromHome:c,beforeShowTrigger:s,skeletonRenderDuration:a}){!function useHandleDiscoveryAccountChanged({num:e,handleAccountChanged:n}){var{activeAccount:t}=(0,f.LH)({num:e}),{selectedAccount:r}=(0,f.wz)({num:e}),o=(0,I.d)(t,200),c=(0,I.d)(r,200),s=(0,i.useRef)(t),a=(0,i.useRef)(r);(0,i.useEffect)((function(){s.current=t,a.current=r}),[t,r]),(0,i.useEffect)((function(){n&&(o.isOthersWallet&&o.account?.id===c.othersWalletAccountId||o.indexedAccount?.id===c.indexedAccountId)&&n({activeAccount:s.current,selectedAccount:a.current},e)}),[o,c,n,e])}({num:e,handleAccountChanged:n});var l=Boolean(c&&!t);return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(d.YGroup,{bg:"$bg",borderRadius:"$3",borderColor:"$borderSubdued",borderWidth:u.A.hairlineWidth,separator:(0,y.jsx)(d.Divider,{}),disabled:t,children:[(0,y.jsx)(d.YGroup.Item,{children:(0,y.jsx)(p.jY,{num:e,beforeShowTrigger:s,disabled:r||t,loadingDuration:0})}),(0,y.jsx)(d.YGroup.Item,{children:(0,y.jsx)(g.Up,{num:e,compressionUiMode:o,beforeShowTrigger:s,loadingDuration:0})})]}),(0,y.jsx)(DAppAccountListInitFromHome,{num:e,shouldSyncFromHome:l})]})}function DAppAccountListStandAloneItem({readonly:e,handleAccountChanged:n,onConnectedAccountInfoChanged:t}){var r=(0,a.A)(),{serviceDApp:c,serviceNetwork:u}=l.A,{$sourceInfo:g}=(0,A.A)(),{result:f}=(0,m.yk)((0,s.A)((function*(){var e,n;if(!g?.origin||!g.scope)return{accountSelectorNum:null,networkIds:null};var t=(0,h.zg)(g.scope),r=t?(yield u.getNetworkIdsByImpls({impls:t})).networkIds:null,o=yield c.getConnectedAccountsInfo({origin:g.origin,scope:null!=(e=g.scope)?e:"",isWalletConnectRequest:g.isWalletConnectRequest});return Array.isArray(o)&&o.length>0&&"number"==typeof o[0]?.num?{accountSelectorNum:o[0].num,networkIds:r,existConnectedAccount:!0}:{accountSelectorNum:yield c.getAccountSelectorNum({origin:g.origin,scope:null!=(n=g.scope)?n:"",isWalletConnectRequest:g.isWalletConnectRequest}),networkIds:r,existConnectedAccount:!1}})),[g?.origin,g?.scope,g?.isWalletConnectRequest,c,u]);return(0,i.useEffect)((function(){o()(f?.accountSelectorNum)&&t&&t({num:f.accountSelectorNum,existConnectedAccount:f.existConnectedAccount})}),[f?.accountSelectorNum,f?.existConnectedAccount,t]),(0,y.jsxs)(d.YStack,{gap:"$2",testID:"DAppAccountListStandAloneItem",children:[(0,y.jsx)(d.SizableText,{size:"$headingMd",color:"$text",children:r.formatMessage({id:S.ETranslations.global_accounts})}),"number"==typeof f?.accountSelectorNum&&Array.isArray(f?.networkIds)?(0,y.jsx)(p.b8,{config:{sceneName:x.Zs.discover,sceneUrl:g?.origin},enabledNum:[f.accountSelectorNum],availableNetworksMap:{[f.accountSelectorNum]:{networkIds:f.networkIds}},children:(0,y.jsx)(DAppAccountListItem,{initFromHome:!f?.existConnectedAccount,num:f?.accountSelectorNum,handleAccountChanged:n,readonly:e})}):null]})}function DAppAccountListStandAloneItemForHomeScene(){var e=(0,a.A)();return(0,y.jsxs)(d.YStack,{gap:"$2",testID:"DAppAccountListStandAloneItem",children:[(0,y.jsx)(d.SizableText,{size:"$headingMd",color:"$text",children:e.formatMessage({id:S.ETranslations.global_accounts})}),(0,y.jsx)(p.b8,{config:{sceneName:x.Zs.home},enabledNum:[0],children:(0,y.jsx)(DAppAccountListItem,{initFromHome:!1,num:0,readonly:!0})})]})}function WalletConnectAccountTriggerList({sceneUrl:e,sessionAccountsInfo:n,handleAccountChanged:t}){var r=n.map((function(e){return e.accountSelectorNum})),o=n.reduce((function(e,n){var t=n.networkIds.filter(Boolean);return e[n.accountSelectorNum]={networkIds:t,defaultNetworkId:t[0]},e}),{});return(0,y.jsxs)(d.YStack,{gap:"$2",children:[(0,y.jsx)(d.SizableText,{size:"$headingMd",color:"$text",children:"Accounts"}),Array.isArray(n)&&n.length?(0,y.jsx)(p.b8,{config:{sceneName:x.Zs.discover,sceneUrl:e},enabledNum:r,availableNetworksMap:o,children:(0,y.jsx)(d.YStack,{gap:"$2",children:n.map((function(e){return(0,y.jsx)(d.Stack,{children:(0,y.jsx)(DAppAccountListItem,{initFromHome:!0,num:e.accountSelectorNum,handleAccountChanged:t})},e.accountSelectorNum)}))})}):null]})}},701378:(e,n,t)=>{t.d(n,{_:()=>DAppRequestedPermissionContent,N:()=>DAppSignMessageContent});var r=t(908867),o=t(17617),c=t(490343),s=t(334439),i=t(831085);function DAppRequestedPermissionContent({requestPermissions:e}){var n=(0,r.A)();return(0,i.jsxs)(c.YStack,{gap:"$2",children:[(0,i.jsx)(c.SizableText,{color:"$text",size:"$headingMd",children:n.formatMessage({id:s.ETranslations.dapp_connect_requested_permissions})}),(0,i.jsx)(c.YStack,{py:"$2.5",px:"$3",gap:"$3",minHeight:"$8",bg:"$bg",borderRadius:"$3",borderWidth:o.A.hairlineWidth,borderColor:"$borderSubdued",borderCurve:"continuous",children:(null!=e?e:[n.formatMessage({id:s.ETranslations.dapp_connect_view_your_balance_and_activity}),n.formatMessage({id:s.ETranslations.dapp_connect_send_approval_requests})]).map((function(e){return(0,i.jsxs)(c.XStack,{gap:"$3",children:[(0,i.jsx)(c.Icon,{name:"CheckLargeOutline",color:"$icon",size:"$5"}),(0,i.jsx)(c.SizableText,{color:"$text",size:"$bodyMd",children:e})]},e)}))})]})}var a=t(514041),u=t(903454),d=t(161024),l=t(901048).Buffer;function DAppSignMessageContent({unsignedMessage:e}){var n=(0,r.A)(),[t,o]=(0,a.useState)(!1),p=(0,a.useMemo)((function(){var{message:n,type:t,payload:r}=e;switch(t){case d.nc.ECDSA:case d.nc.BIP322_SIMPLE:case d.$.ETH_SIGN:case d.nZ.SIMPLE_SIGN:return n;case d.$.PERSONAL_SIGN:case d.nZ.SIGN_MESSAGE:try{return u.toBuffer(n).toString("utf8")}catch(e){return n}case d.nZ.HEX_MESSAGE:return l.from(n,"hex").toString("utf8");case d.nF.SIGN_MESSAGE:var o;return null!=(o=r?.message)?o:n;case d.$.TYPED_DATA_V1:var c,s,i=null!=(c=JSON.parse(n))?c:{};if(i=null!=(s=i.message)?s:i,Array.isArray(i))i=i.reduce((function(e,n){return e[n.name]=n.value,e}),{});return JSON.stringify(i,null,2);case d.$.TYPED_DATA_V3:case d.$.TYPED_DATA_V4:try{var a,p,g=JSON.parse(n);return g=null!=(a=g?.message)?a:g,JSON.stringify("string"==typeof g?null!=(p=JSON.parse(g))?p:{}:g,null,2)}catch{return n}default:return n}}),[e]),g=(0,a.useCallback)((function(){var{message:r,type:a}=e;if(a===d.nc.ECDSA||a===d.nc.BIP322_SIMPLE||a===d.$.ETH_SIGN||a===d.nZ.SIMPLE_SIGN)return null;var u=r;if(a===d.$.TYPED_DATA_V1||a===d.$.TYPED_DATA_V3||a===d.$.TYPED_DATA_V4){try{u=JSON.parse(u)}catch(e){}u=JSON.stringify(u,null,2)}return(0,i.jsxs)(c.YStack,{gap:"$2",children:[(0,i.jsx)(c.Button,{variant:"secondary",onPress:function(){return o(!t)},children:t?n.formatMessage({id:s.ETranslations.dapp_connect_hide_full_message}):n.formatMessage({id:s.ETranslations.dapp_connect_view_full_message})}),t?(0,i.jsx)(c.TextArea,{editable:!1,numberOfLines:11,value:u}):null]})}),[n,e,t]);return(0,i.jsxs)(c.YStack,{justifyContent:"center",children:[(0,i.jsx)(c.SizableText,{color:"$text",size:"$headingMd",mb:"$2",children:n.formatMessage({id:s.ETranslations.dapp_connect_message})}),(0,i.jsxs)(c.YStack,{gap:"$2",children:[(0,i.jsx)(c.TextArea,{value:p,editable:!1,numberOfLines:11}),g()]})]})}},980342:(e,n,t)=>{t.d(n,{A:()=>s});var r=t(490343),o=t(42484),c=t(831085);const s=function DappOpenModalPage({children:e,onClose:n,dappApprove:t}){return(0,c.jsxs)(r.Page,{scrollEnabled:!0,onClose:function(e){e?.flag!==o.n.Confirmed&&t.reject(),"function"==typeof n&&n(e)},children:[(0,c.jsx)(r.Page.Header,{headerShown:!1}),e]})}},321732:(e,n,t)=>{t.r(n),t.d(n,{default:()=>k});var r=t(586330),o=t(514041),c=t(908867),s=t(17617),i=t(490343),a=t(325809),u=t(237532),d=t(334439),l=t(491180),p=t(47412),g=t(184251),A=t(42484),m=t(352325),f=t(161024),h=t(610421),S=t(796895),b=t(24284),x=t(911998),I=t(278484),y=t(701378),_=t(864961),j=t(905710),v=t(980342),w=t(831085),WalletAccountListItem=function({networkId:e,accountId:n}){var t=(0,c.A)(),{result:o,isLoading:p}=(0,x.yk)((0,r.A)((function*(){var t,[r,o,c]=yield Promise.all([h.A.serviceNetwork.getNetworkSafe({networkId:e}),h.A.serviceAccount.getAccount({accountId:n,networkId:e}),h.A.serviceAccount.getWallet({walletId:l.A.getWalletIdFromAccountId({accountId:n})})]);return o.indexedAccountId&&(t=yield h.A.serviceAccount.getIndexedAccount({id:o.indexedAccountId})),{network:r,account:o,wallet:c,indexedAccount:t}})),[e,n]);return(0,w.jsxs)(i.YStack,{gap:"$2",children:[(0,w.jsx)(i.SizableText,{size:"$headingMd",color:"$text",children:t.formatMessage({id:d.ETranslations.global_accounts})}),(0,w.jsxs)(i.YGroup,{bg:"$bg",borderRadius:"$3",borderColor:"$borderSubdued",borderWidth:s.A.hairlineWidth,separator:(0,w.jsx)(i.Divider,{}),disabled:!0,overflow:"hidden",children:[(0,w.jsx)(i.YGroup.Item,{children:(0,w.jsx)(a.rx,{isLoading:p,network:o?.network,triggerDisabled:!0})}),(0,w.jsx)(i.YGroup.Item,{children:(0,w.jsx)(u.cd,{isLoading:p,account:o?.account,wallet:o?.wallet,indexedAccount:o?.indexedAccount,triggerDisabled:!0})})]})]})};const k=function SignMessageModal(){var e,n,t,s,a=(0,c.A)(),[u,l]=(0,o.useState)(!1),{$sourceInfo:k,unsignedMessage:$,accountId:D,networkId:N,walletInternalSign:C}=(0,b.A)(),T=(0,S.A)({id:null!=(e=k?.id)?e:"",closeWindowAfterResolved:!0}),{result:E}=(0,x.yk)((function(){return h.A.serviceNetwork.getNetwork({networkId:N})}),[N]),M=$.type===f.$.ETH_SIGN,O=(0,o.useMemo)((function(){return E?.name?a.formatMessage({id:d.ETranslations.dapp_connect_allow_to_access_your_chain_message_signature},{chain:E.name}):""}),[a,E]),{showContinueOperate:P,continueOperate:L,setContinueOperate:Y,riskLevel:H,urlSecurityInfo:G}=(0,j.q)({origin:null!=(n=k?.origin)?n:"",isRiskSignMethod:M}),R=(0,o.useCallback)((s=(0,r.A)((function*(e){l(!0);try{$.type!==f.$.ETH_SIGN&&$.type!==f.$.PERSONAL_SIGN||(0,p.Xf)($,E?.impl),$.type===f.$.TYPED_DATA_V1&&(0,p.cM)($,E?.impl),$.type!==f.$.TYPED_DATA_V3&&$.type!==f.$.TYPED_DATA_V4||(0,p.a3)($,g.A.getNetworkChainId({networkId:N}),E?.impl)}catch(n){return l(!1),T?.reject({error:n}),void e?.()}try{var n=yield h.A.serviceSend.signMessage({unsignedMessage:$,networkId:N,accountId:D});T.resolve({result:n});try{yield h.A.serviceSignature.addItemFromSignMessage({networkId:N,accountId:D,message:$.message,sourceInfo:k})}catch{}e?.({flag:A.n.Confirmed})}finally{l(!1)}})),function(e){return s.apply(this,arguments)}),[$,E?.impl,N,T,D,k]);return(0,w.jsx)(v.A,{dappApprove:T,children:(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(i.Page.Header,{headerShown:!1}),(0,w.jsx)(i.Page.Body,{children:(0,w.jsxs)(_.HJ,{title:a.formatMessage({id:d.ETranslations.dapp_connect_initiate_message_signature_request}),subtitle:O,origin:null!=(t=k?.origin)?t:"",urlSecurityInfo:G,isRiskSignMethod:M,children:[C?(0,w.jsx)(WalletAccountListItem,{accountId:D,networkId:N}):(0,w.jsx)(I.ZY,{readonly:!0}),(0,w.jsx)(y.N,{unsignedMessage:$})]})}),(0,w.jsx)(i.Page.Footer,{children:(0,w.jsx)(_.OS,{confirmText:a.formatMessage({id:d.ETranslations.dapp_connect_confirm}),continueOperate:L,setContinueOperate:function(e){Y(!!e)},onConfirm:function(e){return R(e)},onCancel:function(){return T.reject()},confirmButtonProps:{loading:u,disabled:!L},showContinueOperateCheckbox:P,riskLevel:M?m._.High:H})})]})})}}}]);