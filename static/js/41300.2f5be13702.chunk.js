"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[41300],{82506:(e,n,t)=>{t.d(n,{d:()=>useDebounce});var o=t(578104);function useDebounce(e,n,t){var[r]=(0,o.d7)(e,n,t);return r}},278484:(e,n,t)=>{t.d(n,{wI:()=>DAppAccountListItem,ZY:()=>DAppAccountListStandAloneItem,X1:()=>DAppAccountListStandAloneItemForHomeScene,VV:()=>WalletConnectAccountTriggerList});var o=t(460986),r=t.n(o),c=t(324586),a=t(586330),s=t(514041),i=t(908867),u=t(17617),l=t(490343),d=t(610421),p=t(325809),m=t(237532),f=t(24284),g=t(911998),A=t(162616),h=t(226952),S=t(334439),b=(t(663522),t(584186)),y=t(714191),x=t(82506);var j=t(831085);function ownKeys(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ownKeys(Object(t),!0).forEach((function(n){(0,c.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function DAppAccountListInitFromHome({num:e,shouldSyncFromHome:n}){var[,t]=(0,A.K7)(),o=(0,A.z$)();return(0,s.useEffect)((function(){return(0,a.A)((function*(){try{t((function(n){return _objectSpread(_objectSpread({},n),{},{[e]:{isLoading:!0}})})),yield b.A.wait(600),n&&(yield o.current.syncFromScene({from:{sceneName:y.Zs.home,sceneNum:0},num:e}))}finally{n&&(yield b.A.wait(300)),t((function(n){return _objectSpread(_objectSpread({},n),{},{[e]:{isLoading:!1}})}))}}))(),function(){t((function(n){return _objectSpread(_objectSpread({},n),{},{[e]:{isLoading:!1}})}))}}),[o,e,t,n]),null}function DAppAccountListItem({num:e,handleAccountChanged:n,readonly:t,networkReadonly:o,compressionUiMode:r,initFromHome:c,beforeShowTrigger:a,skeletonRenderDuration:i}){!function useHandleDiscoveryAccountChanged({num:e,handleAccountChanged:n}){var{activeAccount:t}=(0,A.LH)({num:e}),{selectedAccount:o}=(0,A.wz)({num:e}),r=(0,x.d)(t,200),c=(0,x.d)(o,200),a=(0,s.useRef)(t),i=(0,s.useRef)(o);(0,s.useEffect)((function(){a.current=t,i.current=o}),[t,o]),(0,s.useEffect)((function(){n&&(r.isOthersWallet&&r.account?.id===c.othersWalletAccountId||r.indexedAccount?.id===c.indexedAccountId)&&n({activeAccount:a.current,selectedAccount:i.current},e)}),[r,c,n,e])}({num:e,handleAccountChanged:n});var d=Boolean(c&&!t);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(l.YGroup,{bg:"$bg",borderRadius:"$3",borderColor:"$borderSubdued",borderWidth:u.A.hairlineWidth,separator:(0,j.jsx)(l.Divider,{}),disabled:t,children:[(0,j.jsx)(l.YGroup.Item,{children:(0,j.jsx)(p.jY,{num:e,beforeShowTrigger:a,disabled:o||t,loadingDuration:0})}),(0,j.jsx)(l.YGroup.Item,{children:(0,j.jsx)(m.Up,{num:e,compressionUiMode:r,beforeShowTrigger:a,loadingDuration:0})})]}),(0,j.jsx)(DAppAccountListInitFromHome,{num:e,shouldSyncFromHome:d})]})}function DAppAccountListStandAloneItem({readonly:e,handleAccountChanged:n,onConnectedAccountInfoChanged:t}){var o=(0,i.A)(),{serviceDApp:c,serviceNetwork:u}=d.A,{$sourceInfo:m}=(0,f.A)(),{result:A}=(0,g.yk)((0,a.A)((function*(){var e,n;if(!m?.origin||!m.scope)return{accountSelectorNum:null,networkIds:null};var t=(0,h.zg)(m.scope),o=t?(yield u.getNetworkIdsByImpls({impls:t})).networkIds:null,r=yield c.getConnectedAccountsInfo({origin:m.origin,scope:null!=(e=m.scope)?e:"",isWalletConnectRequest:m.isWalletConnectRequest});return Array.isArray(r)&&r.length>0&&"number"==typeof r[0]?.num?{accountSelectorNum:r[0].num,networkIds:o,existConnectedAccount:!0}:{accountSelectorNum:yield c.getAccountSelectorNum({origin:m.origin,scope:null!=(n=m.scope)?n:"",isWalletConnectRequest:m.isWalletConnectRequest}),networkIds:o,existConnectedAccount:!1}})),[m?.origin,m?.scope,m?.isWalletConnectRequest,c,u]);return(0,s.useEffect)((function(){r()(A?.accountSelectorNum)&&t&&t({num:A.accountSelectorNum,existConnectedAccount:A.existConnectedAccount})}),[A?.accountSelectorNum,A?.existConnectedAccount,t]),(0,j.jsxs)(l.YStack,{gap:"$2",testID:"DAppAccountListStandAloneItem",children:[(0,j.jsx)(l.SizableText,{size:"$headingMd",color:"$text",children:o.formatMessage({id:S.ETranslations.global_accounts})}),"number"==typeof A?.accountSelectorNum&&Array.isArray(A?.networkIds)?(0,j.jsx)(p.b8,{config:{sceneName:y.Zs.discover,sceneUrl:m?.origin},enabledNum:[A.accountSelectorNum],availableNetworksMap:{[A.accountSelectorNum]:{networkIds:A.networkIds}},children:(0,j.jsx)(DAppAccountListItem,{initFromHome:!A?.existConnectedAccount,num:A?.accountSelectorNum,handleAccountChanged:n,readonly:e})}):null]})}function DAppAccountListStandAloneItemForHomeScene(){var e=(0,i.A)();return(0,j.jsxs)(l.YStack,{gap:"$2",testID:"DAppAccountListStandAloneItem",children:[(0,j.jsx)(l.SizableText,{size:"$headingMd",color:"$text",children:e.formatMessage({id:S.ETranslations.global_accounts})}),(0,j.jsx)(p.b8,{config:{sceneName:y.Zs.home},enabledNum:[0],children:(0,j.jsx)(DAppAccountListItem,{initFromHome:!1,num:0,readonly:!0})})]})}function WalletConnectAccountTriggerList({sceneUrl:e,sessionAccountsInfo:n,handleAccountChanged:t}){var o=n.map((function(e){return e.accountSelectorNum})),r=n.reduce((function(e,n){var t=n.networkIds.filter(Boolean);return e[n.accountSelectorNum]={networkIds:t,defaultNetworkId:t[0]},e}),{});return(0,j.jsxs)(l.YStack,{gap:"$2",children:[(0,j.jsx)(l.SizableText,{size:"$headingMd",color:"$text",children:"Accounts"}),Array.isArray(n)&&n.length?(0,j.jsx)(p.b8,{config:{sceneName:y.Zs.discover,sceneUrl:e},enabledNum:o,availableNetworksMap:r,children:(0,j.jsx)(l.YStack,{gap:"$2",children:n.map((function(e){return(0,j.jsx)(l.Stack,{children:(0,j.jsx)(DAppAccountListItem,{initFromHome:!0,num:e.accountSelectorNum,handleAccountChanged:t})},e.accountSelectorNum)}))})}):null]})}},701378:(e,n,t)=>{t.d(n,{_:()=>DAppRequestedPermissionContent,N:()=>DAppSignMessageContent});var o=t(908867),r=t(17617),c=t(490343),a=t(334439),s=t(831085);function DAppRequestedPermissionContent({requestPermissions:e}){var n=(0,o.A)();return(0,s.jsxs)(c.YStack,{gap:"$2",children:[(0,s.jsx)(c.SizableText,{color:"$text",size:"$headingMd",children:n.formatMessage({id:a.ETranslations.dapp_connect_requested_permissions})}),(0,s.jsx)(c.YStack,{py:"$2.5",px:"$3",gap:"$3",minHeight:"$8",bg:"$bg",borderRadius:"$3",borderWidth:r.A.hairlineWidth,borderColor:"$borderSubdued",borderCurve:"continuous",children:(null!=e?e:[n.formatMessage({id:a.ETranslations.dapp_connect_view_your_balance_and_activity}),n.formatMessage({id:a.ETranslations.dapp_connect_send_approval_requests})]).map((function(e){return(0,s.jsxs)(c.XStack,{gap:"$3",children:[(0,s.jsx)(c.Icon,{name:"CheckLargeOutline",color:"$icon",size:"$5"}),(0,s.jsx)(c.SizableText,{color:"$text",size:"$bodyMd",children:e})]},e)}))})]})}var i=t(514041),u=t(903454),l=t(161024),d=t(901048).Buffer;function DAppSignMessageContent({unsignedMessage:e}){var n=(0,o.A)(),[t,r]=(0,i.useState)(!1),p=(0,i.useMemo)((function(){var{message:n,type:t,payload:o}=e;switch(t){case l.nc.ECDSA:case l.nc.BIP322_SIMPLE:case l.$.ETH_SIGN:case l.nZ.SIMPLE_SIGN:return n;case l.$.PERSONAL_SIGN:case l.nZ.SIGN_MESSAGE:try{return u.toBuffer(n).toString("utf8")}catch(e){return n}case l.nZ.HEX_MESSAGE:return d.from(n,"hex").toString("utf8");case l.nF.SIGN_MESSAGE:var r;return null!=(r=o?.message)?r:n;case l.$.TYPED_DATA_V1:var c,a,s=null!=(c=JSON.parse(n))?c:{};if(s=null!=(a=s.message)?a:s,Array.isArray(s))s=s.reduce((function(e,n){return e[n.name]=n.value,e}),{});return JSON.stringify(s,null,2);case l.$.TYPED_DATA_V3:case l.$.TYPED_DATA_V4:try{var i,p,m=JSON.parse(n);return m=null!=(i=m?.message)?i:m,JSON.stringify("string"==typeof m?null!=(p=JSON.parse(m))?p:{}:m,null,2)}catch{return n}default:return n}}),[e]),m=(0,i.useCallback)((function(){var{message:o,type:i}=e;if(i===l.nc.ECDSA||i===l.nc.BIP322_SIMPLE||i===l.$.ETH_SIGN||i===l.nZ.SIMPLE_SIGN)return null;var u=o;if(i===l.$.TYPED_DATA_V1||i===l.$.TYPED_DATA_V3||i===l.$.TYPED_DATA_V4){try{u=JSON.parse(u)}catch(e){}u=JSON.stringify(u,null,2)}return(0,s.jsxs)(c.YStack,{gap:"$2",children:[(0,s.jsx)(c.Button,{variant:"secondary",onPress:function(){return r(!t)},children:t?n.formatMessage({id:a.ETranslations.dapp_connect_hide_full_message}):n.formatMessage({id:a.ETranslations.dapp_connect_view_full_message})}),t?(0,s.jsx)(c.TextArea,{editable:!1,numberOfLines:11,value:u}):null]})}),[n,e,t]);return(0,s.jsxs)(c.YStack,{justifyContent:"center",children:[(0,s.jsx)(c.SizableText,{color:"$text",size:"$headingMd",mb:"$2",children:n.formatMessage({id:a.ETranslations.dapp_connect_message})}),(0,s.jsxs)(c.YStack,{gap:"$2",children:[(0,s.jsx)(c.TextArea,{value:p,editable:!1,numberOfLines:11}),m()]})]})}},441300:(e,n,t)=>{t.r(n),t.d(n,{default:()=>x});var o=t(460986),r=t.n(o),c=t(586330),a=t(514041),s=t(908867),i=t(490343),u=t(334439),l=t(258527),d=t(42484),p=t(610421),m=t(796895),f=t(24284),g=t(278484),A=t(701378),h=t(864961),S=t(905710),b=t(980342),y=t(831085);const x=function ConnectionModal(){var e,n,t,o,x=(0,s.A)(),{serviceDApp:j}=p.A,{$sourceInfo:v}=(0,f.A)(),_=(0,m.A)({id:null!=(e=v?.id)?e:"",closeWindowAfterResolved:!0}),{showContinueOperate:I,continueOperate:C,setContinueOperate:w,riskLevel:k,urlSecurityInfo:D}=(0,S.q)({origin:null!=(n=v?.origin)?n:""}),[N,T]=(0,a.useState)(null),[$,E]=(0,a.useState)(null),[O,M]=(0,a.useState)(null),P=(0,a.useCallback)((function({activeAccount:e,selectedAccount:n}){T(e),E(n)}),[]),L=(0,a.useMemo)((function(){var e;return N?.network?.name?x.formatMessage({id:u.ETranslations.dapp_connect_allow_this_site_to_access},{chain:null!=(e=N?.network?.name)?e:""}):""}),[N?.network?.name,x]),W=(0,a.useMemo)((function(){return!C||!N?.account?.address&&!N?.account?.addressDetail.isValid}),[N,C]),Y=(0,a.useCallback)((o=(0,c.A)((function*(e){var n,t,o,c;if(!v?.scope)return i.Toast.error({title:"no injected scope"}),void(v&&l.U.discovery.dapp.dappUse({dappName:v?.hostname,dappDomain:v?.origin,action:"ConnectWallet",network:N?.network?.name,failReason:"no injected scope"}));if(!N||!N.account)return i.Toast.error({title:"no account"}),void l.U.discovery.dapp.dappUse({dappName:v?.hostname,dappDomain:v?.origin,action:"ConnectWallet",network:N?.network?.name,failReason:"no account"});var{wallet:a,account:s,network:p,indexedAccount:m,deriveType:f="default"}=N,g={networkImpl:null!=(n=p?.impl)?n:"",walletId:null!=(t=a?.id)?t:"",indexedAccountId:null!=(o=m?.id)?o:"",networkId:null!=(c=p?.id)?c:"",accountId:s.id,address:s.address,deriveType:f,focusedWallet:$?.focusedWallet,othersWalletAccountId:$?.othersWalletAccountId};if(O?.existConnectedAccount){if(!r()(O?.num))throw _.reject(),l.U.discovery.dapp.dappUse({dappName:v.hostname,dappDomain:v?.origin,action:"ConnectWallet",network:p?.name,failReason:"no accountSelectorNum"}),new Error("no accountSelectorNum");yield j.updateConnectionSession({origin:v?.origin,updatedAccountInfo:g,storageType:"injectedProvider",accountSelectorNum:O.num})}else yield j.saveConnectionSession({origin:v?.origin,accountsInfo:[g],storageType:"injectedProvider"});yield _.resolve({close:function(){e?.({flag:d.n.Confirmed})},result:g}),i.Toast.success({title:x.formatMessage({id:u.ETranslations.global_connected})}),l.U.discovery.dapp.dappUse({dappName:v.hostname,dappDomain:v?.origin,action:"ConnectWallet",network:p?.name})})),function(e){return o.apply(this,arguments)}),[x,_,v,j,N,$,O]);return(0,y.jsx)(b.A,{dappApprove:_,children:(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(i.Page.Header,{headerShown:!1}),(0,y.jsx)(i.Page.Body,{children:(0,y.jsxs)(h.HJ,{title:x.formatMessage({id:u.ETranslations.dapp_connect_connection_request}),subtitle:L,origin:null!=(t=v?.origin)?t:"",urlSecurityInfo:D,children:[(0,y.jsx)(g.ZY,{handleAccountChanged:P,onConnectedAccountInfoChanged:M}),(0,y.jsx)(A._,{})]})}),(0,y.jsx)(i.Page.Footer,{children:(0,y.jsx)(h.OS,{continueOperate:C,setContinueOperate:function(e){return w(!!e)},onConfirm:Y,onCancel:function(){return _.reject()},confirmButtonProps:{disabled:W},showContinueOperateCheckbox:I,riskLevel:k})})]})})}},980342:(e,n,t)=>{t.d(n,{A:()=>a});var o=t(490343),r=t(42484),c=t(831085);const a=function DappOpenModalPage({children:e,onClose:n,dappApprove:t}){return(0,c.jsxs)(o.Page,{scrollEnabled:!0,onClose:function(e){e?.flag!==r.n.Confirmed&&t.reject(),"function"==typeof n&&n(e)},children:[(0,c.jsx)(o.Page.Header,{headerShown:!1}),e]})}}}]);